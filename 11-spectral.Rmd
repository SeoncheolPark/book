# 스펙트럼 분석 {#spectral}

이 절의 내용은 [@Shumway2010]를 참고하였다.

## 순환 움직임과 주기성(cyclical behavior and periodicity)

다음과 같은 주기과정(periodic process)을 생각해보자.
$$x_{t}=A\cos(2\pi\omega t + \phi), \qquad{\text{for } t=0,\pm 1, \pm 2, \ldots,}$$
여기서

- $\omega$: **진동수 지수(frequency index)** (단위 시간 당 순환의 갯수)

- $A$: **진폭(amplitude)** (신호의 높이 결정)

- $\phi$: **위상(phase)** (코사인 함수의 시작 지점)

이다. 다음과 같은 삼각함수 공식 $\cos (\alpha \pm \beta)= \cos (\alpha) \cos (\beta) \mp \sin(\alpha)\sin(\beta)$을 이용하면 위 식은
$$x_{t}=U_{1}\cos(2\pi\omega t) + U_{2}\sin(2\pi\omega t)$$
가 되며 $U_{1}=A\cos \phi$, $U_{2}=-\sin\phi$는 종종 정규분포를 따르는 확률변수로 취급한다. 그리고 이 때 $A=\sqrt{U_{1}^{2}+U_{2}^{2}}$, $\phi=\tan^{-1}(-U_{2}/U_{1})$이다. 이 사실로부터, $A$와 $\phi$가 독립인 확률변수면, $A^{2}\sim \chi_{2}$, $\phi \sim \text{Unif}(-\pi, \pi)$이며 $U_{1}$과 $U_{2}$는 독립인 표준 정규분포를 따른다.

앞선 랜덤과정(random process)는 진동수 $\omega$를 모수로 하여 표현할 수 있다.

### 중첩 주파수(folding frequency)

### 앨리어싱(aliasing)

```{r, fig.align='center', echo=FALSE, warning=FALSE, message=FALSE, results='hide', fig.cap = 'Periodic components and their sums.'}
x1 = 2*cos(2*pi*1:100*6/100) + 3*sin(2*pi*1:100*6/100)
x2 = 4*cos(2*pi*1:100*10/100) + 5*sin(2*pi*1:100*10/100)
x3 = 6*cos(2*pi*1:100*40/100) + 7*sin(2*pi*1:100*40/100)
x = x1 + x2 + x3
par(mfrow=c(2,2))
plot.ts(x1, ylim=c(-10,10), main=expression(omega==6/100~~~A^2==13))
plot.ts(x2, ylim=c(-10,10), main=expression(omega==10/100~~~A^2==41))
plot.ts(x3, ylim=c(-10,10), main=expression(omega==40/100~~~A^2==85))
plot.ts(x, ylim=c(-16,16), main="sum")
```

## 피리오도그램(periodogram)

이 절의 서술은 [@Lim2013]을 참고하였다. 또 다른 참고자료로는 [@Shumway2010]이 있다.

다음과 같은 시계열 자료의 수열 $\{Y_{1}, \ldots, Y_{n}\}$을 관측한다고 하자. 그러면 **피리오도그램(periodogram)** $I_{n}(\omega)$는
$$I_{n}(\omega)=\frac{1}{n}| \sum_{i=1}^{n}Y_{i}e^{-it\omega}|^{2}$$
로 정의된다. 이 때 $\omega\in (0,\pi)$는 **진동수모수(frequency parameter)**이다. $\omega$가 푸리에 진동수($\omega=\frac{2\pi k}{n}, k\in\mathbb{Z}$)일 때 이 피리오도그램은
$$I_{n}(\omega)=\frac{n}{4}\| \tilde{\boldsymbol{\beta}}_{n}(\omega)\|^{2}$$
으로 표현할 수 있다고 한다[@Li2008]. 여기서 $\| \cdot \|$은 벡터의 $l_{2}$ 노름이며 $\tilde{\boldsymbol{\beta}}_{n}(\omega)$은 최소자승법
$$\tilde{\boldsymbol{\beta}}_{n}(\omega)=\text{arg}\min_{\boldsymbol{\beta}\in\mathbb{R}^{2}}\sum_{i=1}^{n}| Y_{i}-\mathbf{x}_{t}^{T}(\omega)\boldsymbol{\beta}^{2}$$
의 해다. 그리고 이 때 $\mathbf{x}_{t}(\omega)=(\cos(\omega t), \sin (\omega t))^{T}$로 harmonic regressor다.

## R 예제(R-periodogram)

여기서는 R에서 피리오도그램을 그리는 방법에 대해 다뤄보겠다.

1. 직접 구현

2. 이미 구현된 패키지 안의 함수들을 이용하는 경우

```{r, message=F, echo=F}
library(xts)
library(quantspec)
library(TSA)
library(kza)
library(itsmr)
source('~/Dropbox/R files/SeoulDataContest/Sources/Source.R', chdir = TRUE)
```

여기서는 서울특별시 PM10의 1998년 1월부터 2014년 12월까지의 월별 시계열 자료를 이용해 피리오도그램을 그려보겠다.

```{r, fig.align='center', comment=">", fig.cap = 'Time series of Seoul PM10.'}
dataspec <- read.csv('~/Dropbox/Data/PM/MonthlyPMSeoul.csv', header=T)
dataspec <- dataspec[,-1]
dataspec <- t(dataspec)
time_index_month <- seq(from = as.POSIXct("1998-01-01"), to = as.POSIXct("2014-12-01"), by = "month")
dataspec <- xts(dataspec[,1], order.by=time_index_month)
plot(dataspec, type='o', ylim=c(0,150), xlab="Month", main="Monthly")
```

`TSA`, `kza`, `itsmr` 패키지를 이용한다. 같은 이름의 함수를 사용하기 때문에 실행할 때 주의해야 한다.

```{r, fig.align='center', comment=">", fig.cap = 'Periodogram (using R package TSA).'}
TSA::periodogram(dataspec, log='yes')
```

```{r, fig.align='center', comment=">", fig.cap = 'Periodogram (using R package kza).'}
plot(kza::periodogram(as.numeric(dataspec)), type='o')
```

```{r, fig.align='center', comment=">", fig.cap = 'Periodogram (using R package itsmr).'}
plot(itsmr::periodogram(dataspec))
```
