# 일반화가법모형 {#gam}

일반화가법모형에 대한 참고문헌으로는 [@Wood2006]이 있다. 최근에 나온 좋은 책으로는 [@Yee2015]가 있으며 이 책은 주로 **벡터 일반화선형모형(vector genearlized linear model, VGLMs)** 및 **벡터 일반화가법모형(vector generalized addtive model, VGAMs)**에 초점을 맞추고 있고 R 코드를 포함하고 있다.

## 퇴각 적합화(backfitting)

**퇴각 적합화(backfitting)**은 GAM을 적합하기 위한 단순하면서도 아름다운 방법이다. 이 알고리즘의 기본 아이디어는 가법모형의 각 smooth component들에 대해 iteratively하게 가법모형의 smooth partial residuals를 계산하는 것이다. 

다음과 같은 가법모형에서 추정을 하고 싶다고 가정하자.
$$y_{i}=\alpha + \sum_{j=1}^{m}f_{j}(x_{ji})+\epsilon_{i},$$
여기서 $f_{i}$는 부드러운 함수들(smooth functions)이며 공변량 $x_{j}$는 때때로 벡터이기도 하다. $\hat{\mathbf{f}}_{j}$를 $i$째 원소의 추정값이 $f_{j}(x_{ji})$인 벡터라고 하자. 그러면 기본적인 퇴각 적합화 알고리즘은 다음과 같다.

1. Set $\alpha=\bar{y}$ and $\hat{\mathbf{f}}_{j}=\mathbf{0}$ for $j=1,\ldots , m$.

2. Repeat step 3 to 5 until teh estimates $\hat{\mathbf{f}}_{j}=\mathbf{0}$ stop changing.

3. For $j=1,\ldots ,m$, repeat steps 4 and 5.

4. Calculate partial residuals:
$$\mathbf{e}_{P}^{j}=\mathbf{y}-\hat{\alpha}-\sum_{k\neq j}\hat{\mathbf{f}}_{k}.$$

5. Set $\hat{\mathbf{f}}_{j}$ equal to the result of smoothing $e_{p}^{j}$ with respect to $x_{j}$.

## R 예제(R-gam)

```{r, message=F, echo=F}
library(wavethresh)
```

알고리즘을 짜면 다음과 같다.

```{r, comment=">", eval=F, echo=T}
f<-x*0;alpha<-mean(y);ok <- TRUE
while (ok) { # backfitting loop
  for (i in 1:m) { # loop through the smooth terms
    ep <- y - rowSums(f[,-i]) - alpha
    b <- smooth.spline(x[,i],ep,df=edf[i])
    f[,i] <- predict(b,x[,i])$y
  }
  rss <- sum((y-rowSums(f))ˆ2)
  if (abs(rss-rss0)<1e-6*rss) ok <- FALSE
  rss0 <- rss
}
```
